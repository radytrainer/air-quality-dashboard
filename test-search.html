<!DOCTYPE html>
<html>
<head>
    <title>Search Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .search-container { margin: 20px 0; }
        .search-input { padding: 10px; width: 400px; border: 1px solid #ccc; border-radius: 4px; }
        .results { margin-top: 10px; border: 1px solid #ccc; border-radius: 4px; max-height: 300px; overflow-y: auto; }
        .result-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .result-item:hover { background-color: #f5f5f5; }
    </style>
</head>
<body>
    <h1>Location Search Test</h1>
    
    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Search any Location, City, State or Country..." />
        <div id="results" class="results" style="display: none;"></div>
    </div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const resultsDiv = document.getElementById('results');
        let searchTimeout;

        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value;
            
            if (query.length < 2) {
                resultsDiv.style.display = 'none';
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`http://127.0.0.1:8000/api/search-locations?q=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    
                    if (data.status === 'ok' && data.data.length > 0) {
                        resultsDiv.innerHTML = data.data.map(location => 
                            `<div class="result-item" onclick="selectLocation('${location.name}', '${location.country}', ${location.lat}, ${location.lon}, ${location.aqi})">
                                <strong>${location.name}</strong>, ${location.country}
                                ${location.aqi ? ` - AQI: ${location.aqi}` : ''}
                            </div>`
                        ).join('');
                        resultsDiv.style.display = 'block';
                    } else {
                        resultsDiv.innerHTML = '<div class="result-item">No results found</div>';
                        resultsDiv.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Search failed:', error);
                    resultsDiv.innerHTML = '<div class="result-item">Search failed</div>';
                    resultsDiv.style.display = 'block';
                }
            }, 300);
        });

        function selectLocation(name, country, lat, lon, aqi) {
            alert(`Selected: ${name}, ${country}\nCoordinates: ${lat}, ${lon}\nAQI: ${aqi || 'N/A'}`);
            resultsDiv.style.display = 'none';
            searchInput.value = name;
        }
    </script>
</body>
</html>
